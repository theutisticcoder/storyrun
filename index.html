<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURO-TRACK // Cyperpunk Audio Runner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=JetBrains+Mono:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-blue: #00f2ff;
            --neon-green: #00ff9f;
            --dark-bg: #0a0a0c;
        }

        body {
            background-color: var(--dark-bg);
            color: white;
            font-family: 'JetBrains Mono', monospace;
            overflow-x: hidden;
        }

        .cyber-font { font-family: 'Orbitron', sans-serif; }

        .neon-text-pink { text-shadow: 0 0 5px var(--neon-pink); color: var(--neon-pink); }
        .neon-text-blue { text-shadow: 0 0 5px var(--neon-blue); color: var(--neon-blue); }

        .glitch-overlay {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .scanline {
            width: 100%; height: 2px; background: rgba(0, 242, 255, 0.1);
            position: absolute; animation: scan 4s linear infinite;
        }

        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }

        .progress-bar { height: 4px; background: #222; position: relative; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--neon-blue); width: 0%; transition: width 0.3s ease; box-shadow: 0 0 15px var(--neon-blue); }

        .btn-cyber {
            background: transparent; border: 1px solid var(--neon-green); color: var(--neon-green);
            padding: 10px 20px; transition: all 0.2s;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }

        .btn-cyber:hover { background: var(--neon-green); color: black; box-shadow: 0 0 20px var(--neon-green); }

        .active-slot { border-color: var(--neon-pink) !important; box-shadow: 0 0 10px var(--neon-pink); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="glitch-overlay fixed inset-0 z-50 opacity-20"></div>
    <div class="scanline z-50"></div>

    <header class="w-full max-w-md mb-6 text-center">
        <h1 class="cyber-font text-3xl font-bold tracking-widest neon-text-blue mb-2">NEURO-TRACK v1.2</h1>
        <div class="text-[10px] text-gray-500 uppercase tracking-tighter">Full Stream Sync // Creative Commons Node</div>
    </header>

    <main class="w-full max-w-md bg-black/40 backdrop-blur-md p-6 rounded-lg border border-gray-800 relative">
        <!-- Distance Counter -->
        <div class="text-center mb-6">
            <div class="text-xs text-cyan-400 mb-1">TOTAL TRAVERSE DISTANCE</div>
            <div id="distance-display" class="cyber-font text-6xl font-bold">0.00</div>
            <div class="text-sm text-gray-400">MILES</div>
        </div>

        <!-- Multi-Slot Indicators -->
        <div class="grid grid-cols-3 gap-2 mb-6">
            <div id="slot-0" class="border border-gray-800 p-2 text-center text-[8px] transition-all">STREAM_A</div>
            <div id="slot-1" class="border border-gray-800 p-2 text-center text-[8px] transition-all">STREAM_B</div>
            <div id="slot-2" class="border border-gray-800 p-2 text-center text-[8px] transition-all">STREAM_C</div>
        </div>

        <div class="mb-6">
            <div class="flex justify-between text-[10px] mb-1 text-pink-500">
                <span>NEXT DATA PACKET</span>
                <span id="next-milestone-text">1.00 MILES</span>
            </div>
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
        </div>

        <!-- Audio Player -->
        <div id="audio-container" class="border-t border-gray-800 pt-6 mt-6 hidden">
            <div class="flex items-center gap-4 mb-4">
                <div class="w-12 h-12 bg-pink-900/30 flex items-center justify-center border border-pink-500">
                    <svg class="w-6 h-6 text-pink-400 animate-pulse" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
                </div>
                <div class="flex-1 overflow-hidden">
                    <div id="audio-title" class="text-sm font-bold truncate">Awaiting Milestone...</div>
                    <div id="audio-author" class="text-xs text-gray-500 truncate">CC BY-NC</div>
                    <div id="chapter-info" class="text-[9px] text-pink-400 mt-1 uppercase tracking-widest">Chapter Access Granted</div>
                </div>
            </div>
            <audio id="main-audio" controls class="w-full filter invert opacity-80 brightness-150"></audio>
        </div>

        <button id="start-btn" class="btn-cyber w-full text-lg font-bold mt-6">INITIATE TRACKING</button>
    </main>

    <section class="w-full max-w-md mt-6 bg-black/80 p-3 rounded border border-gray-900 text-[10px] font-mono text-green-500 h-32 overflow-y-auto" id="console"></section>

    <script>
        // Full Chapter Lists for Classical Open Source Titles
        const MASTER_LIBRARY = [
            { 
                title: "Journey to the Center of the Earth", 
                author: "Jules Verne", 
                chapters: Array.from({length: 44}, (_, i) => `https://ia800203.us.archive.org/21/items/journey_center_earth_rs_librivox/journey_center_earth_${String(i+1).padStart(2, '0')}_verne.mp3`)
            },
            { 
                title: "Frankenstein", 
                author: "Mary Shelley", 
                chapters: Array.from({length: 24}, (_, i) => `https://ia800204.us.archive.org/16/items/frankenstein_librivox/frankenstein_${String(i+1).padStart(2, '0')}_shelley.mp3`)
            },
            { 
                title: "The Time Machine", 
                author: "H.G. Wells", 
                chapters: Array.from({length: 12}, (_, i) => `https://ia800701.us.archive.org/11/items/time_machine_librivox/timemachine_${String(i+1).padStart(2, '0')}_wells.mp3`)
            },
            { 
                title: "The Art of War", 
                author: "Sun Tzu", 
                chapters: Array.from({length: 13}, (_, i) => `https://ia801406.us.archive.org/11/items/art_of_war_librivox/art_of_war_${String(i+1).padStart(2, '0')}_tzu.mp3`)
            },
            { 
                title: "The Metamorphosis", 
                author: "Franz Kafka", 
                chapters: [
                    "https://ia801402.us.archive.org/21/items/metamorphosis_librivox/metamorphosis_1_kafka.mp3",
                    "https://ia801402.us.archive.org/21/items/metamorphosis_librivox/metamorphosis_2_kafka.mp3",
                    "https://ia801402.us.archive.org/21/items/metamorphosis_librivox/metamorphosis_3_kafka.mp3"
                ]
            },
            {
                title: "The War of the Worlds",
                author: "H.G. Wells",
                chapters: Array.from({length: 27}, (_, i) => `https://ia800201.us.archive.org/26/items/war_of_the_worlds_librivox/waroftheworlds_${String(i+1).padStart(2, '0')}_wells.mp3`)
            }
        ];

        // State Management
        let totalDistance = 0;
        let lastPosition = null;
        let isTracking = false;
        let watchId = null;
        let mileCounter = 0;
        
        let activeStreams = [null, null, null]; 

        const distDisplay = document.getElementById('distance-display');
        const progFill = document.getElementById('progress-fill');
        const startBtn = document.getElementById('start-btn');
        const consoleLog = document.getElementById('console');
        const nextMilestoneLabel = document.getElementById('next-milestone-text');
        const audioContainer = document.getElementById('audio-container');
        const audioPlayer = document.getElementById('main-audio');
        const audioTitle = document.getElementById('audio-title');
        const audioAuthor = document.getElementById('audio-author');
        const chapterInfo = document.getElementById('chapter-info');

        function addLog(msg) {
            const div = document.createElement('div');
            div.textContent = `> ${msg}`;
            consoleLog.prepend(div);
        }

        function pickNewBook() {
            const available = MASTER_LIBRARY.filter(b => !activeStreams.some(s => s && s.title === b.title));
            const picked = available.length > 0 
                ? available[Math.floor(Math.random() * available.length)] 
                : MASTER_LIBRARY[Math.floor(Math.random() * MASTER_LIBRARY.length)];
            return { ...picked, currentChapter: 0 };
        }

        function initStreams() {
            for(let i=0; i<3; i++) {
                activeStreams[i] = pickNewBook();
                addLog(`SLOT_${String.fromCharCode(65+i)} INITIALIZED: ${activeStreams[i].title}`);
                document.getElementById(`slot-${i}`).textContent = activeStreams[i].title.substring(0, 10) + '...';
            }
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3958.8;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        function triggerNextChapter() {
            mileCounter++;
            const streamIndex = (mileCounter - 1) % 3;
            let stream = activeStreams[streamIndex];

            // Visual indicator
            document.querySelectorAll('[id^="slot-"]').forEach(el => el.classList.remove('active-slot', 'neon-text-pink'));
            const slotEl = document.getElementById(`slot-${streamIndex}`);
            slotEl.classList.add('active-slot', 'neon-text-pink');

            // Play chapter
            audioContainer.classList.remove('hidden');
            audioTitle.textContent = stream.title;
            audioAuthor.textContent = stream.author;
            chapterInfo.textContent = `CHAPTER ${stream.currentChapter + 1} OF ${stream.chapters.length} UNLOCKED`;
            audioPlayer.src = stream.chapters[stream.currentChapter];
            
            addLog(`STREAM INTERCEPT [SLOT ${streamIndex}]: ${stream.title} - CH ${stream.currentChapter + 1}`);
            
            audioPlayer.play().catch(() => addLog("PLAYBACK BUFFERED - INTERACTION REQUIRED"));

            // Increment or Replace
            stream.currentChapter++;
            if (stream.currentChapter >= stream.chapters.length) {
                addLog(`BOOK COMPLETED: ${stream.title}. Decomissioning stream...`);
                activeStreams[streamIndex] = pickNewBook();
                addLog(`NEW STREAM LINKED: ${activeStreams[streamIndex].title}`);
                slotEl.textContent = activeStreams[streamIndex].title.substring(0, 10) + '...';
            }
        }

        function updateUI() {
            distDisplay.textContent = totalDistance.toFixed(2);
            const progress = (totalDistance % 1) * 100;
            progFill.style.width = `${progress}%`;
            nextMilestoneLabel.textContent = `${(Math.floor(totalDistance) + 1).toFixed(2)} MILES`;

            if (totalDistance >= mileCounter + 1) {
                triggerNextChapter();
            }
        }

        function toggleTracking() {
            if (isTracking) {
                navigator.geolocation.clearWatch(watchId);
                isTracking = false;
                startBtn.textContent = "INITIATE TRACKING";
                addLog("CONNECTION DROPPED");
            } else {
                if (!activeStreams[0]) initStreams();
                isTracking = true;
                startBtn.textContent = "TERMINATE LINK";
                addLog("ESTABLISHING NEURAL LINK...");
                
                watchId = navigator.geolocation.watchPosition((pos) => {
                    const { latitude, longitude, accuracy } = pos.coords;
                    if (accuracy > 60) return;
                    if (lastPosition) {
                        const d = calculateDistance(lastPosition.latitude, lastPosition.longitude, latitude, longitude);
                        if (d > 0.002) { 
                            totalDistance += d;
                            updateUI();
                        }
                    }
                    lastPosition = { latitude, longitude };
                }, (err) => addLog(`GPS ERR: ${err.message}`), { enableHighAccuracy: true });
            }
        }

        startBtn.addEventListener('click', toggleTracking);
        addLog("SYSTEM IDLE. AWAITING USER AUTH...");
    </script>
</body>
</html>